{% extends "master.html.twig" %}

{% block addHead %}
    <script>
    $(document).ready(function() {

       $('#changePhoto').on('submit', function(e) {

           e.preventDefault();
            // Check file selected or not
            $.ajax({
                 url: '/profile/uploadPhoto',
                type: 'post',
                data: new FormData(this),
                contentType: false,
                processData: false,
                success: function(retVal) {
                    if (retVal == 1) {
                        $('.img-thumbnail').show();
                        location.reload();
                    } else {
                        $('.img_err').html(retVal);
                    }
                }
            })
        })

        $('#changePass').click(function() {
            
            $('.profile').hide();
            $('.changePass').show();
            
        });

        $('.changePass').on('submit', function(e) {

            $('.pass_err').html("");
            e.preventDefault();
            var origPw = $("input[name=origPw]").val();
            var newPw = $("input[name=newPw]").val();
            var newPwRepeat = $("input[name=newPwRepeat]").val();
            var passObj = {origPw: origPw, newPw: newPw, newPwRepeat: newPwRepeat};
            var jsonString = JSON.stringify(passObj);
            $.ajax({
                    url: '/profile/changepass',
                    type: 'post',
                    data: jsonString,
                    dataType: 'json'
                }).done(function(retVal) {
                    if (retVal == 1) {
                        $("input[name=origPw]").val("");
                        $("input[name=newPw]").val("");
                        $("input[name=newPwRepeat]").val("");
                        $('.pass_err').html("Password changed successfully.");
                    } else {
                        $('.pass_err').html(retVal);
                    }
                })
        });

        $('#changeProf').click(function() {
            
            $('.profile').show();
            $('.changePass').hide();
        });

    }) // document.ready
    </script>
{% endblock %}

{% block header %}
    <h1>Profile</h1>
    <h3>{{success}}</h3>
{% endblock %}

{% block content %}
    {% if user.role is same as("broker") %}
        {% include "profile-broker.html.twig" %}
    {% else %}
        {% include "profile-buyer.html.twig" %}
    {% endif %}
    
{% endblock %}